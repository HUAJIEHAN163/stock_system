import re

def update_api_classification():
    """更新API分类"""
    
    # 读取更新后的URL列表
    with open('D:\\stock_system\\tushare网页.txt', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 提取所有URL和对应的doc_id
    urls = re.findall(r'https://tushare\.pro/document/2\?doc_id=(\d+)', content)
    
    # 基于更新后的分类规则
    batch_apis = {
        '基础数据': {
            25: '股票列表',
            329: '上市公司基本信息',
            26: '交易日历',
            397: '股票曾用名',
            398: '沪深股通成分股',
            100: 'HS300成分股',
            112: '上证50成分股',
            193: '中证500成分股',
            194: '中证1000成分股',
            375: '上证380成分股',
            123: '科创板股票',
            262: '创业板股票'
        },
        '行情数据': {
            27: 'A股日线行情',
            372: '周线行情',
            370: '月线行情',
            374: '复权因子',
            144: '停复牌信息',
            145: '每日停复牌统计',
            146: '停牌原因',
            336: '每日涨跌停价格',
            365: '每日涨跌停统计',
            28: '指数日线行情',
            315: '指数基本信息',
            316: '指数成分和权重',
            317: '申万行业一级指数',
            32: '大盘指数每日指标',
            109: '市场通用行情接口',
            183: '沪深市场通用行情接口',
            214: '港股通每日成交统计',
            48: '备用行情接口',
            255: '港股行情'
        },
        '财务数据': {
            33: '利润表',
            36: '资产负债表',
            44: '现金流量表',
            45: '业绩预告',
            46: '业绩快报',
            103: '分红送股',
            79: '财务指标数据',
            80: '财务审计意见',
            81: '主营业务构成',
            162: '财务数据'
        },
        '参考数据': {
            61: '沪深股通资金流向',
            62: '沪深股通十大成交股',
            110: '中概股列表',
            111: '中概股月线行情',
            124: '港股列表',
            160: '港股通成分股',
            161: '港股通每日成交统计',
            166: '港股通资金流向',
            175: '港股通十大成交股'
        },
        '特色数据': {
            292: '概念股分类',
            293: '概念股列表',
            294: '地域分类',
            296: '申万行业分类',
            328: '申万行业成分',
            295: '中信行业分类',
            274: '券商盈利预测数据',
            188: '限售股解禁',
            353: '股权质押统计数据',
            354: '股权质押明细',
            364: '股票技术因子',
            399: '每日筹码分布',
            275: '同花顺概念和行业',
            267: '同花顺概念'
        },
        '资金流向': {
            170: '个股资金流向',
            348: '沪深港通资金流向',
            349: '沪深港通十大成交股',
            371: '港股通十大成交股',
            343: '每日指标',
            344: '通用行情接口',
            345: '沪深市场通用行情接口',
            47: '备用行情接口'
        },
        '打板数据': {
            106: '涨跌停统计',
            107: '每日涨跌停价格',
            355: '涨跌停股票统计',
            298: '股票回购',
            356: '概念股分类',
            357: '概念股列表',
            259: '限售股解禁',
            260: '股权质押统计数据',
            261: '股权质押明细',
            362: '股票技术面因子',
            363: '每日筹码分布',
            382: '每日筹码集中度',
            369: '股票技术因子',
            311: '同花顺概念和行业',
            312: '同花顺概念',
            320: '申万行业分类',
            321: '申万行业成分',
            376: '中信行业分类',
            377: '中信行业指数行情',
            378: '中信行业指数成分股',
            347: '每日重要指标',
            350: 'A股特色数据',
            351: '市场交易统计'
        }
    }
    
    single_apis = {
        '两融转融通': {
            58: '融资融券交易汇总',
            59: '融资融券交易明细',
            326: '融资融券可充抵保证金证券',
            332: '融资融券标的证券',
            331: '转融通担保品',
            333: '转融券成交明细',
            334: '转融资成交明细'
        }
    }
    
    # 生成新的Markdown文件
    md_content = """# Tushare API 接口分类

## 📊 可以批量获取的数据

"""
    
    # 添加批量API
    for category, api_dict in batch_apis.items():
        md_content += f"### {category}\n"
        for doc_id, name in api_dict.items():
            if str(doc_id) in urls:
                md_content += f"- [{name}](https://tushare.pro/document/2?doc_id={doc_id})\n"
        md_content += "\n"
    
    md_content += """## 🎯 单只股票逐条获取的数据

"""
    
    # 添加单股API
    for category, api_dict in single_apis.items():
        md_content += f"### {category}\n"
        for doc_id, name in api_dict.items():
            if str(doc_id) in urls:
                md_content += f"- [{name}](https://tushare.pro/document/2?doc_id={doc_id})\n"
        md_content += "\n"
    
    md_content += """## 📝 分类说明

### 批量获取数据特点
- ✅ 可通过日期范围、市场类型等条件一次性获取多只股票数据
- ✅ 适合历史数据回测和批量分析
- ✅ API调用效率高，使用量少

### 单股逐条获取数据特点
- ⚠️ 需要指定具体股票代码
- ⚠️ 通常用于实时查询或特定股票详细信息
- ⚠️ 需要循环调用，API使用量大

---
*更新时间: 2024年*
*总计接口数量: {}个*""".format(len(urls))
    
    # 保存更新后的文件
    with open('D:\\stock_system\\tushare_api_classification.md', 'w', encoding='utf-8') as f:
        f.write(md_content)
    
    print(f"已更新分类文档，共处理 {len(urls)} 个API接口")
    print("文件已保存: tushare_api_classification.md")

if __name__ == "__main__":
    update_api_classification()