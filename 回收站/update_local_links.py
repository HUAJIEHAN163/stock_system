import re
import os

def update_classification_with_local_links():
    """æ›´æ–°åˆ†ç±»æ–‡æ¡£ï¼Œæ·»åŠ æœ¬åœ°æ–‡æ¡£é“¾æ¥"""
    
    # APIåˆ†ç±»æ•°æ®
    api_data = {
        'å¤šåªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢ï¼ˆçœŸæ­£æ‰¹é‡æ•°æ®ï¼‰': {
            'åŸºç¡€æ•°æ®': {
                25: 'è‚¡ç¥¨åˆ—è¡¨', 329: 'ä¸Šå¸‚å…¬å¸åŸºæœ¬ä¿¡æ¯', 26: 'äº¤æ˜“æ—¥å†',
                100: 'HS300æˆåˆ†è‚¡', 112: 'ä¸Šè¯50æˆåˆ†è‚¡', 193: 'ä¸­è¯500æˆåˆ†è‚¡',
                194: 'ä¸­è¯1000æˆåˆ†è‚¡', 375: 'ä¸Šè¯380æˆåˆ†è‚¡', 123: 'ç§‘åˆ›æ¿è‚¡ç¥¨', 262: 'åˆ›ä¸šæ¿è‚¡ç¥¨'
            },
            'è¡Œæƒ…æ•°æ®': {
                27: 'Aè‚¡æ—¥çº¿è¡Œæƒ…', 372: 'å‘¨çº¿è¡Œæƒ…', 370: 'æœˆçº¿è¡Œæƒ…', 28: 'æŒ‡æ•°æ—¥çº¿è¡Œæƒ…',
                315: 'æŒ‡æ•°åŸºæœ¬ä¿¡æ¯', 316: 'æŒ‡æ•°æˆåˆ†å’Œæƒé‡', 317: 'ç”³ä¸‡è¡Œä¸šä¸€çº§æŒ‡æ•°',
                32: 'å¤§ç›˜æŒ‡æ•°æ¯æ—¥æŒ‡æ ‡', 109: 'å¸‚åœºé€šç”¨è¡Œæƒ…æ¥å£', 183: 'æ²ªæ·±å¸‚åœºé€šç”¨è¡Œæƒ…æ¥å£',
                48: 'å¤‡ç”¨è¡Œæƒ…æ¥å£', 255: 'æ¸¯è‚¡è¡Œæƒ…'
            },
            'å‚è€ƒæ•°æ®': {
                61: 'æ²ªæ·±è‚¡é€šèµ„é‡‘æµå‘', 62: 'æ²ªæ·±è‚¡é€šåå¤§æˆäº¤è‚¡', 110: 'ä¸­æ¦‚è‚¡åˆ—è¡¨',
                111: 'ä¸­æ¦‚è‚¡æœˆçº¿è¡Œæƒ…', 124: 'æ¸¯è‚¡åˆ—è¡¨', 160: 'æ¸¯è‚¡é€šæˆåˆ†è‚¡',
                161: 'æ¸¯è‚¡é€šæ¯æ—¥æˆäº¤ç»Ÿè®¡', 166: 'æ¸¯è‚¡é€šèµ„é‡‘æµå‘', 175: 'æ¸¯è‚¡é€šåå¤§æˆäº¤è‚¡'
            },
            'ç‰¹è‰²æ•°æ®': {
                292: 'æ¦‚å¿µè‚¡åˆ†ç±»', 293: 'æ¦‚å¿µè‚¡åˆ—è¡¨', 294: 'åœ°åŸŸåˆ†ç±»',
                296: 'ç”³ä¸‡è¡Œä¸šåˆ†ç±»', 328: 'ç”³ä¸‡è¡Œä¸šæˆåˆ†', 295: 'ä¸­ä¿¡è¡Œä¸šåˆ†ç±»'
            }
        },
        'å•åªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢': {
            'è¡Œæƒ…æ•°æ®': {374: 'å¤æƒå› å­', 144: 'åœå¤ç‰Œä¿¡æ¯', 336: 'æ¯æ—¥æ¶¨è·Œåœä»·æ ¼'},
            'è´¢åŠ¡æ•°æ®': {
                33: 'åˆ©æ¶¦è¡¨', 36: 'èµ„äº§è´Ÿå€ºè¡¨', 44: 'ç°é‡‘æµé‡è¡¨', 45: 'ä¸šç»©é¢„å‘Š',
                46: 'ä¸šç»©å¿«æŠ¥', 103: 'åˆ†çº¢é€è‚¡', 79: 'è´¢åŠ¡æŒ‡æ ‡æ•°æ®',
                80: 'è´¢åŠ¡å®¡è®¡æ„è§', 81: 'ä¸»è¥ä¸šåŠ¡æ„æˆ', 162: 'è´¢åŠ¡æ•°æ®'
            },
            'ç‰¹è‰²æ•°æ®': {
                274: 'åˆ¸å•†ç›ˆåˆ©é¢„æµ‹æ•°æ®', 188: 'é™å”®è‚¡è§£ç¦', 353: 'è‚¡æƒè´¨æŠ¼ç»Ÿè®¡æ•°æ®',
                354: 'è‚¡æƒè´¨æŠ¼æ˜ç»†', 364: 'è‚¡ç¥¨æŠ€æœ¯å› å­', 399: 'æ¯æ—¥ç­¹ç åˆ†å¸ƒ',
                275: 'åŒèŠ±é¡ºæ¦‚å¿µå’Œè¡Œä¸š', 267: 'åŒèŠ±é¡ºæ¦‚å¿µ'
            },
            'èµ„é‡‘æµå‘': {170: 'ä¸ªè‚¡èµ„é‡‘æµå‘'}
        },
        'å•åªè‚¡ç¥¨é€æ¡è·å–ï¼ˆå•æ—¥å•è‚¡ï¼‰': {
            'åŸºç¡€æ•°æ®': {397: 'è‚¡ç¥¨æ›¾ç”¨å', 398: 'æ²ªæ·±è‚¡é€šæˆåˆ†è‚¡'},
            'è¡Œæƒ…æ•°æ®': {
                145: 'æ¯æ—¥åœå¤ç‰Œç»Ÿè®¡', 146: 'åœç‰ŒåŸå› ', 365: 'æ¯æ—¥æ¶¨è·Œåœç»Ÿè®¡', 214: 'æ¸¯è‚¡é€šæ¯æ—¥æˆäº¤ç»Ÿè®¡'
            },
            'èµ„é‡‘æµå‘': {
                348: 'æ²ªæ·±æ¸¯é€šèµ„é‡‘æµå‘', 349: 'æ²ªæ·±æ¸¯é€šåå¤§æˆäº¤è‚¡', 371: 'æ¸¯è‚¡é€šåå¤§æˆäº¤è‚¡',
                343: 'æ¯æ—¥æŒ‡æ ‡', 344: 'é€šç”¨è¡Œæƒ…æ¥å£', 345: 'æ²ªæ·±å¸‚åœºé€šç”¨è¡Œæƒ…æ¥å£', 47: 'å¤‡ç”¨è¡Œæƒ…æ¥å£'
            },
            'æ‰“æ¿æ•°æ®': {
                106: 'æ¶¨è·Œåœç»Ÿè®¡', 107: 'æ¯æ—¥æ¶¨è·Œåœä»·æ ¼', 355: 'æ¶¨è·Œåœè‚¡ç¥¨ç»Ÿè®¡', 298: 'è‚¡ç¥¨å›è´­',
                356: 'æ¦‚å¿µè‚¡åˆ†ç±»', 357: 'æ¦‚å¿µè‚¡åˆ—è¡¨', 259: 'é™å”®è‚¡è§£ç¦', 260: 'è‚¡æƒè´¨æŠ¼ç»Ÿè®¡æ•°æ®',
                261: 'è‚¡æƒè´¨æŠ¼æ˜ç»†', 362: 'è‚¡ç¥¨æŠ€æœ¯é¢å› å­', 363: 'æ¯æ—¥ç­¹ç åˆ†å¸ƒ', 382: 'æ¯æ—¥ç­¹ç é›†ä¸­åº¦',
                369: 'è‚¡ç¥¨æŠ€æœ¯å› å­', 311: 'åŒèŠ±é¡ºæ¦‚å¿µå’Œè¡Œä¸š', 312: 'åŒèŠ±é¡ºæ¦‚å¿µ', 320: 'ç”³ä¸‡è¡Œä¸šåˆ†ç±»',
                321: 'ç”³ä¸‡è¡Œä¸šæˆåˆ†', 376: 'ä¸­ä¿¡è¡Œä¸šåˆ†ç±»', 377: 'ä¸­ä¿¡è¡Œä¸šæŒ‡æ•°è¡Œæƒ…', 378: 'ä¸­ä¿¡è¡Œä¸šæŒ‡æ•°æˆåˆ†è‚¡',
                347: 'æ¯æ—¥é‡è¦æŒ‡æ ‡', 350: 'Aè‚¡ç‰¹è‰²æ•°æ®', 351: 'å¸‚åœºäº¤æ˜“ç»Ÿè®¡'
            },
            'ä¸¤èè½¬èé€š': {
                58: 'èèµ„èåˆ¸äº¤æ˜“æ±‡æ€»', 59: 'èèµ„èåˆ¸äº¤æ˜“æ˜ç»†', 326: 'èèµ„èåˆ¸å¯å……æŠµä¿è¯é‡‘è¯åˆ¸',
                332: 'èèµ„èåˆ¸æ ‡çš„è¯åˆ¸', 331: 'è½¬èé€šæ‹…ä¿å“', 333: 'è½¬èåˆ¸æˆäº¤æ˜ç»†', 334: 'è½¬èèµ„æˆäº¤æ˜ç»†'
            }
        }
    }
    
    # ç”Ÿæˆæ–°çš„åˆ†ç±»æ–‡æ¡£
    md_content = """# Tushare API æ¥å£ç²¾ç¡®åˆ†ç±»

> ğŸ“ **æœ¬åœ°æ–‡æ¡£**: æ‰€æœ‰APIè¯¦ç»†è¯´æ˜å·²ä¿å­˜åˆ° `docs/` ç›®å½•  
> ğŸ”— **é“¾æ¥è¯´æ˜**: ç‚¹å‡»APIåç§°å¯è·³è½¬åˆ°æœ¬åœ°è¯¦ç»†æ–‡æ¡£

"""
    
    # å›¾æ ‡æ˜ å°„
    icons = {
        'å¤šåªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢ï¼ˆçœŸæ­£æ‰¹é‡æ•°æ®ï¼‰': 'ğŸ“Š',
        'å•åªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢': 'ğŸ¯', 
        'å•åªè‚¡ç¥¨é€æ¡è·å–ï¼ˆå•æ—¥å•è‚¡ï¼‰': 'âš ï¸'
    }
    
    for main_category, categories in api_data.items():
        icon = icons.get(main_category, 'ğŸ“‹')
        md_content += f"## {icon} {main_category}\n\n"
        
        for category, apis in categories.items():
            md_content += f"### {category}\n"
            for doc_id, api_name in apis.items():
                # ç”Ÿæˆæœ¬åœ°æ–‡æ¡£è·¯å¾„
                safe_filename = re.sub(r'[<>:"/\\|?*]', '_', api_name)
                local_file = f"docs/{doc_id}_{safe_filename}.md"
                
                # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                if os.path.exists(f"D:\\stock_system\\{local_file}"):
                    md_content += f"- [{api_name}]({local_file}) | [åœ¨çº¿æ–‡æ¡£](https://tushare.pro/document/2?doc_id={doc_id})\n"
                else:
                    md_content += f"- [{api_name}](https://tushare.pro/document/2?doc_id={doc_id}) âš ï¸æœ¬åœ°æ–‡æ¡£ç¼ºå¤±\n"
            md_content += "\n"
    
    md_content += """## ğŸ“ åˆ†ç±»è¯´æ˜

### å¤šåªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢ç‰¹ç‚¹
- âœ… å¯é€šè¿‡æ—¥æœŸèŒƒå›´ä¸€æ¬¡æ€§è·å–å¤šåªè‚¡ç¥¨çš„å†å²æ•°æ®
- âœ… æœ€é€‚åˆå†å²æ•°æ®å›æµ‹å’Œæ‰¹é‡åˆ†æ  
- âœ… APIè°ƒç”¨æ•ˆç‡æœ€é«˜ï¼Œä½¿ç”¨é‡æœ€å°‘

### å•åªè‚¡ç¥¨å¤šæ—¥æŸ¥è¯¢ç‰¹ç‚¹
- ğŸ”„ éœ€è¦æŒ‡å®šè‚¡ç¥¨ä»£ç ï¼Œä½†å¯è·å–è¯¥è‚¡ç¥¨çš„å†å²æ•°æ®
- ğŸ”„ é€‚åˆå•è‚¡æ·±åº¦åˆ†æå’Œå†å²å›æµ‹
- ğŸ”„ éœ€è¦å¾ªç¯è°ƒç”¨å¤šåªè‚¡ç¥¨ï¼Œä½†å•æ¬¡è°ƒç”¨è·å¾—å¤šæ—¥æ•°æ®

### å•åªè‚¡ç¥¨é€æ¡è·å–ç‰¹ç‚¹
- âš ï¸ éœ€è¦æŒ‡å®šå…·ä½“è‚¡ç¥¨ä»£ç å’Œæ—¥æœŸ
- âš ï¸ é€šå¸¸ç”¨äºå®æ—¶æŸ¥è¯¢æˆ–ç‰¹å®šæ—¶ç‚¹æ•°æ®
- âš ï¸ APIä½¿ç”¨é‡æœ€å¤§ï¼Œæ•ˆç‡æœ€ä½

## ğŸ“– ä½¿ç”¨è¯´æ˜

### æœ¬åœ°æ–‡æ¡£ç‰¹ç‚¹
- ğŸ“„ **æ ¼å¼**: Markdownæ ¼å¼ï¼Œæ”¯æŒè¡¨æ ¼å’Œä»£ç é«˜äº®
- ğŸ” **å†…å®¹**: åŒ…å«APIå‚æ•°è¯´æ˜ã€è¿”å›å­—æ®µã€ä»£ç ç¤ºä¾‹
- ğŸ’¾ **ç¦»çº¿**: æ— éœ€ç½‘ç»œå³å¯æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- ğŸ”— **åŒé“¾æ¥**: æä¾›æœ¬åœ°æ–‡æ¡£å’Œåœ¨çº¿æ–‡æ¡£ä¸¤ä¸ªé“¾æ¥

### æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
- âœ… **Markdown (.md)**: æ¨èæ ¼å¼ï¼Œæ”¯æŒæœ¬åœ°è·³è½¬
- âœ… **HTML (.html)**: æµè§ˆå™¨ç›´æ¥æ‰“å¼€
- âœ… **æ–‡æœ¬ (.txt)**: çº¯æ–‡æœ¬æ ¼å¼
- âŒ **Word (.docx)**: ä¸æ”¯æŒç›´æ¥é“¾æ¥è·³è½¬

---
*æ›´æ–°æ—¶é—´: 2024å¹´*  
*æ€»è®¡æ¥å£: {}ä¸ª | æœ¬åœ°æ–‡æ¡£: docs/ ç›®å½•*""".format(
        sum(sum(len(subcategory) for subcategory in category.values()) for category in api_data.values())
    )
    
    # ä¿å­˜æ›´æ–°åçš„æ–‡ä»¶
    with open('D:\\stock_system\\tushare_api_classification.md', 'w', encoding='utf-8') as f:
        f.write(md_content)
    
    print("å·²æ›´æ–°åˆ†ç±»æ–‡æ¡£ï¼Œæ·»åŠ æœ¬åœ°é“¾æ¥")
    print("æ”¯æŒçš„é“¾æ¥æ ¼å¼:")
    print("- Markdown (.md): æ”¯æŒæœ¬åœ°è·³è½¬")
    print("- HTML (.html): æµè§ˆå™¨æ‰“å¼€")
    print("- ç›¸å¯¹è·¯å¾„é“¾æ¥: docs/æ–‡ä»¶å.md")

if __name__ == "__main__":
    update_classification_with_local_links()